function handleFileSelect(){var e=this;if(e.files&&e.files.length){var a=new FileReader;this.enabled=!1,a.onload=function(t){e.files[0].name.match(/.(png|jpg|jpeg|gif|bmp|ico)$/i)?($("#bank-demo-logo-preview").attr({src:a.result}),$("#submit_btn").prop("disabled",!1)):($("#bank-demo-logo-preview").attr({src:bankLogo}),$("#submit_btn").prop("disabled",!0))},a.readAsDataURL(e.files[0])}}function handleFileSelectEdit(){var e=this;if(e.files&&e.files.length){var a=new FileReader;this.enabled=!1,a.onload=function(t){e.files[0].name.match(/.(png|jpg|jpeg|gif|bmp|ico)$/i)?(""!=$(".thumb-bank-logo").attr("data-bank-logo")&&($(".thumb-bank-logo").attr({src:a.result}),$(".remove_edit_bank_logo_preview").remove()),$(".thumb-bank-logo").attr({src:a.result}),$("#edit_submit_btn").prop("disabled",!1)):($(".thumb-bank-logo").attr({src:bankLogo}),$(".remove_edit_bank_logo_preview").remove(),$("#edit_submit_btn").prop("disabled",!0))},a.readAsDataURL(e.files[0])}}function getCpmId(e,a,t){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",url:ADMIN_URL+"/settings/payment-methods/getCpmId",cache:!1,dataType:"json",data:{bank_id:e,currency_id:a}}).done(function(n){if(!0==n.status){$("#bank_id").val(e),$("#edit_currency_id").val(a),$("#edit_paymentMethod").val(t),$("#currencyPaymentMethodId").val(n.cpmId),$("#edit_default").val(n.is_default);var r=JSON.parse(n.cpmActivatedFor);for(let d in $("input:checkbox").prop("checked",!1),r)r.hasOwnProperty(d)&&$("input[value='"+d+"']").prop("checked",!0);$("#edit_account_name").val(n.account_name),$("#edit_account_number").val(n.account_number),$("#edit_branch_address").val(n.bank_branch_address),$("#edit_branch_city").val(n.bank_branch_city),$("#edit_branch_name").val(n.bank_branch_name),$("#edit_bank_name").val(n.bank_name),$("#edit_country").val(n.country_id),$("#edit_swift_code").val(n.swift_code),n.bank_logo&&n.file_id?($("#file_id").val(n.file_id),$(".preview_edit_bank_logo").html(`<img class="thumb-bank-logo" data-bank-logo="${n.bank_logo}" data-file-id="${n.file_id}" src="${SITE_URL}/public/uploads/files/bank_logos/${n.bank_logo}" width="120" height="80"/><span class="remove_edit_bank_logo_preview"></span>`)):$(".preview_edit_bank_logo").html(`<img class="thumb-bank-logo" src="${SITE_URL}/public/uploads/userPic/default-image.png" width="120" height="80"/>`),$("#editModal").show()}else swal(errorTitle,noResponseText,"error")})}function getPaymentMethodsDetails(){var e=$("#currency_id").val(),a=$("#paymentMethod").val(),t=$("input[name=_token]").val(),n=ADMIN_URL+"/settings/get-payment-methods-details";$.ajax({url:n,type:"post",data:{currency_id:e,paymentMethod:a,_token:t},dataType:"json",success:function(e){if(!0==e.flag&&"Bank"==e.methodTitle){let a="";$.each(e.banks,function(e,t){a+='<tr><td class="d-none">'+t.id+"</td><td>"+t.bank_name+"</td><td>"+t.account_name+"&nbsp;&nbsp;(*****"+t.account_number.substr(-4)+")&nbsp;&nbsp;"+t.bank_name+"</td><td>"+checkBankDefault(t.is_default)+'</td><td><a data-id="'+t.id+'" data-bs-toggle="modal" data-bs-target="#editModal" class="btn btn-xs btn-primary edit-setting"><i class="fa fa-edit"></i></a> <button data-id="'+t.id+'" type="button" class="btn btn-xs btn-danger delete"><i class="fa fa-trash"></i></button></td></tr>'}),$("#bank_body").html(a)}else if(!0==isActiveMobileMoney&&!0==e.flag&&"MobileMoney"==e.methodTitle){let t="";$.each(e.mobileMoneys,function(e,a){t+='<tr><td class="d-none">'+a.id+"</td><td>"+a.mobilemoney_name+"</td><td>"+a.mobilemoney_number+"</td><td>"+a.holder_name+"</td><td>"+a.merchant_code+"</td><td>"+checkBankDefault(a.is_default)+"</td><td>"+checkBankStatus(a.activated_for)+'</td><td><a data-id="'+a.id+'" class="btn btn-xs btn-primary mobile-money-edit-setting"><i class="fa fa-edit"></i></a> <button data-id="'+a.id+'" type="button" class="btn btn-xs btn-danger mobilemoney_delete"><i class="fa fa-trash"></i></button></td></tr>'}),$("#mobilemoney_body").html(t)}else $("#bank_body").html(""),!0==isActiveMobileMoney&&$("#mobilemoney_body").html("");if(200==e.status){$("#id").val(e.currencyPaymentMethod.id),$("#stripe_secret_key").val(JSON.parse(e.currencyPaymentMethod.method_data).secret_key),$("#stripe_publishable_key").val(JSON.parse(e.currencyPaymentMethod.method_data).publishable_key),$("#paypal_client_id").val(JSON.parse(e.currencyPaymentMethod.method_data).client_id),$("#paypal_client_secret").val(JSON.parse(e.currencyPaymentMethod.method_data).client_secret),$("#paypal_mode").val(JSON.parse(e.currencyPaymentMethod.method_data).mode),$("#payUMoney_key").val(JSON.parse(e.currencyPaymentMethod.method_data).key),$("#payUMoney_salt").val(JSON.parse(e.currencyPaymentMethod.method_data).salt),$("#payUMoney_mode").val(JSON.parse(e.currencyPaymentMethod.method_data).mode),$("#coinPayments_merchant_id").val(JSON.parse(e.currencyPaymentMethod.method_data).merchant_id),$("#coinPayments_public_key").val(JSON.parse(e.currencyPaymentMethod.method_data).public_key),$("#coinPayments_private_key").val(JSON.parse(e.currencyPaymentMethod.method_data).private_key),$("#payeer_merchant_id").val(JSON.parse(e.currencyPaymentMethod.method_data).merchant_id),$("#payeer_secret_key").val(JSON.parse(e.currencyPaymentMethod.method_data).secret_key),$("#payeer_encryption_key").val(JSON.parse(e.currencyPaymentMethod.method_data).encryption_key),$("#payeer_merchant_domain").val(JSON.parse(e.currencyPaymentMethod.method_data).merchant_domain),$("#cash_merchant_reference").val(JSON.parse(e.currencyPaymentMethod.method_data).merchant_reference),$("#mobile_payment_number").val(JSON.parse(e.currencyPaymentMethod.method_data).payment_number),$("#processing_time").val(e.currencyPaymentMethod.processing_time);var n=JSON.parse(e.currencyPaymentMethod.activated_for);for(let r in $("input:checkbox").prop("checked",!1),n)n.hasOwnProperty(r)&&$("input[value='"+r+"']").prop("checked",!0);n.hasOwnProperty("deposit")?($("#stripe_status").val("Active"),$("#paypal_status").val("Active"),$("#payUMoney_status").val("Active"),$("#coinPayments_status").val("Active"),$("#payeer_status").val("Active"),$("#cash_status").val("Active"),$("#mobile_status").val("Active")):($("#stripe_status").val("Inactive"),$("#paypal_status").val("Inactive"),$("#payUMoney_status").val("Inactive"),$("#coinPayments_status").val("Inactive"),$("#payeer_status").val("Inactive"),$("#cash_status").val("Inactive"),$("#mobile_status").val("Inactive"))}else $("#id").val(""),$("#stripe_secret_key").val(""),$("#stripe_publishable_key").val(""),$("#paypal_client_id").val(""),$("#paypal_client_secret").val(""),$("#paypal_mode").val(""),$("#payUMoney_key").val(""),$("#payUMoney_salt").val(""),$("#payUMoney_mode").val(""),$("#coinPayments_merchant_id").val(""),$("#coinPayments_public_key").val(""),$("#coinPayments_private_key").val(""),$("#payeer_merchant_id").val(""),$("#payeer_secret_key").val(""),$("#payeer_encryption_key").val(""),$("#payeer_merchant_domain").val(""),$("#cash_merchant_reference").val(""),$("#mobile_payment_number").val(""),$("#processing_time").val(""),$("#stripe_status").val(""),$("#paypal_status").val(""),$("#payUMoney_status").val(""),$("#coinPayments_status").val(""),$("#payeer_status").val(""),$("#cash_status").val(""),$("#mobile_status").val(""),$("input:checkbox").prop("checked",!1)},error:function(e){swal(failedText,JSON.parse(e.responseText).message,"error")}})}function getPaymentMethodsSpecificCurrencyDetails(){var e=$("#currency_id").val(),a=$("#paymentMethod").val(),t=$("input[name=_token]").val(),n=ADMIN_URL+"/settings/get-payment-methods-specific-currency-details";$.ajax({url:n,type:"post",data:{currency_id:e,paymentMethod:a,_token:t},dataType:"json",success:function(e){if(!0==e.flag&&"Bank"==e.methodTitle){var a="";$.each(e.banks,function(e,t){a+='<tr><td class="d-none">'+t.id+"</td><td>"+t.bank_name+"</td><td>"+t.account_name+"&nbsp;&nbsp;(*****"+t.account_number.substr(-4)+")&nbsp;&nbsp;"+t.bank_name+"</td><td>"+checkBankDefault(t.is_default)+'</td><td><a data-id="'+t.id+'" data-bs-toggle="modal" data-bs-target="#editModal" class="btn btn-xs btn-primary edit-setting"><i class="fa fa-edit"></i></a> <button data-id="'+t.id+'" type="button" class="btn btn-xs btn-danger delete"><i class="fa fa-trash"></i></button></td></tr>'}),$("#bank_body").html(a)}else if(!0==isActiveMobileMoney&&!0==e.flag&&"MobileMoney"==e.methodTitle){var a="";$.each(e.mobileMoneys,function(e,t){a+='<tr><td class="d-none">'+t.id+"</td><td>"+t.mobilemoney_name+"</td><td>"+t.mobilemoney_number+"</td><td>"+t.holder_name+"</td><td>"+t.merchant_code+"</td><td>"+checkBankDefault(t.is_default)+"</td><td>"+checkBankStatus(t.activated_for)+'</td><td><a data-id="'+t.id+'" class="btn btn-xs btn-primary mobile-money-edit-setting"><i class="fa fa-edit"></i></a> <button data-id="'+t.id+'" type="button" class="btn btn-xs btn-danger mobilemoney_delete"><i class="fa fa-trash"></i></button></td></tr>'}),$("#mobilemoney_body").html(a)}else $("#bank_body").html(""),!0==isActiveMobileMoney&&$("#mobilemoney_body").html("");if(200==e.status){$(".currencyName").text(e.currency.name),$("#currency_id").val(e.currency.id),$("#stripe_secret_key").val(JSON.parse(e.currencyPaymentMethod.method_data).secret_key),$("#stripe_publishable_key").val(JSON.parse(e.currencyPaymentMethod.method_data).publishable_key),$("#paypal_client_id").val(JSON.parse(e.currencyPaymentMethod.method_data).client_id),$("#paypal_client_secret").val(JSON.parse(e.currencyPaymentMethod.method_data).client_secret),$("#paypal_mode").val(JSON.parse(e.currencyPaymentMethod.method_data).mode),$("#payUMoney_key").val(JSON.parse(e.currencyPaymentMethod.method_data).key),$("#payUMoney_salt").val(JSON.parse(e.currencyPaymentMethod.method_data).salt),$("#payUMoney_mode").val(JSON.parse(e.currencyPaymentMethod.method_data).mode),$("#coinPayments_merchant_id").val(JSON.parse(e.currencyPaymentMethod.method_data).merchant_id),$("#coinPayments_public_key").val(JSON.parse(e.currencyPaymentMethod.method_data).public_key),$("#coinPayments_private_key").val(JSON.parse(e.currencyPaymentMethod.method_data).private_key),$("#payeer_merchant_id").val(JSON.parse(e.currencyPaymentMethod.method_data).merchant_id),$("#payeer_secret_key").val(JSON.parse(e.currencyPaymentMethod.method_data).secret_key),$("#payeer_encryption_key").val(JSON.parse(e.currencyPaymentMethod.method_data).encryption_key),$("#payeer_merchant_domain").val(JSON.parse(e.currencyPaymentMethod.method_data).merchant_domain),$("#cash_merchant_reference").val(JSON.parse(e.currencyPaymentMethod.method_data).merchant_reference),$("#mobile_payment_number").val(JSON.parse(e.currencyPaymentMethod.method_data).payment_number),$("#processing_time").val(e.currencyPaymentMethod.processing_time);var t=JSON.parse(e.currencyPaymentMethod.activated_for);for(let n in $("input:checkbox").prop("checked",!1),t)t.hasOwnProperty(n)&&$("input[value='"+n+"']").prop("checked",!0);t.hasOwnProperty("deposit")?($("#stripe_status").val("Active"),$("#paypal_status").val("Active"),$("#payUMoney_status").val("Active"),$("#coinPayments_status").val("Active"),$("#payeer_status").val("Active"),$("#cash_status").val("Active"),$("#mobile_status").val("Active")):($("#stripe_status").val("Inactive"),$("#paypal_status").val("Inactive"),$("#payUMoney_status").val("Inactive"),$("#coinPayments_status").val("Inactive"),$("#payeer_status").val("Inactive"),$("#cash_status").val("Inactive"),$("#mobile_status").val("Inactive"))}else $("#id").val(""),$(".currencyName").text(e.currency.name),$("#currency_id").val(e.currency.id),$("#stripe_secret_key").val(""),$("#stripe_publishable_key").val(""),$("#paypal_client_id").val(""),$("#paypal_client_secret").val(""),$("#paypal_mode").val(""),$("#payUMoney_key").val(""),$("#payUMoney_salt").val(""),$("#payUMoney_mode").val(""),$("#coinPayments_merchant_id").val(""),$("#coinPayments_public_key").val(""),$("#coinPayments_private_key").val(""),$("#payeer_merchant_id").val(""),$("#payeer_secret_key").val(""),$("#payeer_encryption_key").val(""),$("#payeer_merchant_domain").val(""),$("#cash_merchant_reference").val(""),$("#mobile_payment_number").val(""),$("#processing_time").val(""),$("#stripe_status").val(""),$("#paypal_status").val(""),$("#payUMoney_status").val(""),$("#coinPayments_status").val(""),$("#payeer_status").val(""),$("#cash_status").val(""),$("#mobile_status").val(""),$("input:checkbox").prop("checked",!1)},error:function(e){swal(failedText,JSON.parse(e.responseText).message,"error")}})}function checkBankDefault(e){var a="";return"Yes"==e?a='<span class="label label-success">'+yesText+"</span>":"No"==e&&(a='<span class="label label-danger">'+noText+"</span>"),a}function checkBankStatus(e){var a="";return JSON.parse(e).hasOwnProperty("deposit")?'<span class="label label-success">'+activeText+"</span>":'<span class="label label-danger">'+inactiveText+"</span>"}$(function(){$(".select2").select2({})}),$("#currencyPaymentMethod_form").validate({rules:{"stripe[secret_key]":{required:!0},"stripe[publishable_key]":{required:!0},"paypal[client_id]":{required:!0},"paypal[client_secret]":{required:!0},"paypal[mode]":{required:!0},"payUmoney[key]":{required:!0},"payUmoney[salt]":{required:!0},"payUmoney[mode]":{required:!0},"coinpayments[merchant_id]":{required:!0},"coinpayments[public_key]":{required:!0},"coinpayments[private_key]":{required:!0},"payeer[merchant_id]":{required:!0},"payeer[secret_key]":{required:!0},"payeer[encryption_key]":{required:!0},"payeer[merchant_domain]":{required:!0},"cash[merchant_reference]":{required:!0},cash_status:{required:!0},"cash[payment_number]":{required:!0},mobile_status:{required:!0},processing_time:{required:!0,number:!0}},messages:{"paypal[mode]":{required:modeRequire},"payUmoney[mode]":{required:modeRequire}},submitHandler:function(e){$("#paymentMethodList_update").attr("disabled",!0),$("#cancel_anchor").attr("disabled","disabled"),$(".fa-spinner").removeClass("d-none"),$("#paymentMethodList_update_text").text(updateText),$("#paymentMethodList_update").click(!1),$("#cancel_anchor").click(!1),e.submit()}}),$("#add-bank").validate({rules:{account_name:{required:!0},default:{required:!0},status:{required:!0},account_number:{required:!0},swift_code:{required:!0},bank_name:{required:!0},branch_name:{required:!0},branch_city:{required:!0},branch_address:{required:!0},country:{required:!0},bank_logo:{extension:extensionsValidationRule}},messages:{bank_logo:{extension:extensionsValidationMessage}},submitHandler:function(e){$("#submit_btn").attr("disabled",!0),$(".fa-spinner").removeClass("d-none"),$("#bank-add-submit-btn-text"),$("#bank-add-submit-btn-text").text(submitText);var a=new FormData;a.append("_token",$("input[name=_token]").val()),a.append("currency_id",$("#currency_id").val()),a.append("paymentMethod",$("#paymentMethod").val()),a.append("default",$("#default").val()),a.append("status",$("#status").val()),a.append("account_name",$("#account_name").val()),a.append("account_number",$("#account_number").val()),a.append("swift_code",$("#swift_code").val()),a.append("bank_name",$("#bank_name").val()),a.append("branch_name",$("#branch_name").val()),a.append("branch_city",$("#branch_city").val()),a.append("branch_address",$("#branch_address").val()),a.append("country",$("#country").val());let t=$("input[name='add_transaction_type']:checked").map(function(){return $(this).val()}).get();a.append("transaction_type",JSON.stringify(t));var n=document.getElementById("bank_logo");let r=void 0!==n.files[0]?n.files[0]:"";return a.append("bank_logo",r),$.ajax({method:"POST",url:ADMIN_URL+"/settings/payment-methods/add-bank",cache:!1,dataType:"json",contentType:!1,processData:!1,data:a}).done(function(e){if($("#submit_btn").attr("disabled",!1),!0==e.status)$("#edit_currency_id").val(e.currency_id),$("#edit_paymentMethod").val(e.paymentMethod),$("#addModal").modal("hide"),swal({title:titleText,text:e.message,type:"success"},function(){window.location.reload()});else{var a="";$.each(e.message,function(e,t){a+="<li>"+t+"</li>"}),$("#add-bank-error").css("display","block"),$("#add-bank-error-messages").html(a)}}),!1}}),$("#edit-bank").validate({rules:{edit_account_name:{required:!0},edit_account_number:{required:!0},edit_swift_code:{required:!0},edit_bank_name:{required:!0},edit_branch_name:{required:!0},edit_branch_city:{required:!0},edit_branch_address:{required:!0},edit_country:{required:!0},edit_bank_logo:{extension:extensionsValidationRule}},messages:{edit_bank_logo:{extension:extensionsValidationMessage}},submitHandler:function(e){$("#edit_submit_btn").attr("disabled",!0),$(".fa-spinner").removeClass("d-none"),$("#bank-edit-submit-btn-text"),$("#bank-edit-submit-btn-text").text(updateText);var a=new FormData;a.append("_token",$("input[name=_token]").val()),a.append("bank_id",$("#bank_id").val()),a.append("file_id",$("#file_id").val()),a.append("currencyPaymentMethodId",$("#currencyPaymentMethodId").val()),a.append("currency_id",$("#edit_currency_id").val()),a.append("paymentMethod",$("#edit_paymentMethod").val()),a.append("default",$("#edit_default").val()),a.append("status",$("#edit_status").val()),a.append("account_name",$("#edit_account_name").val()),a.append("account_number",$("#edit_account_number").val()),a.append("swift_code",$("#edit_swift_code").val()),a.append("bank_name",$("#edit_bank_name").val()),a.append("branch_name",$("#edit_branch_name").val()),a.append("branch_city",$("#edit_branch_city").val()),a.append("branch_address",$("#edit_branch_address").val()),a.append("country",$("#edit_country").val());let t=$("input[name='update_transaction_type']:checked").map(function(){return $(this).val()}).get();a.append("transaction_type",JSON.stringify(t));var n=document.getElementById("edit_bank_logo");let r=void 0!==n.files[0]?n.files[0]:"";return a.append("bank_logo",r),$.ajax({method:"POST",url:ADMIN_URL+"/settings/payment-methods/update-bank",cache:!1,dataType:"json",contentType:!1,processData:!1,data:a}).done(function(e){if($("#edit_submit_btn").attr("disabled",!1),!0==e.status)$("#editModal").modal("hide"),swal({title:titleText,text:e.message,type:"success"},function(){window.location.reload()});else{var a="";$.each(e.message,function(e,t){a+="<li>"+t+"</li>"}),$("#bank-error").css("display","block"),$("#bank-error-messages").html(a)}}).fail(function(){swal(errorTitle,errorText,"error")}),!1}}),$(document).ready(function(){$("#addModal").on("hidden.bs.modal",function(e){$("#add-bank").validate().resetForm(),$("#add-bank").find(".error").removeClass("error"),$("#submit_btn").prop("disabled",!1),$("#bank_logo").val(""),$("#bank-demo-logo-preview").attr({src:bankLogo})}),$("#editModal").on("hidden.bs.modal",function(e){$("#edit-bank").validate().resetForm(),$("#edit-bank").find(".error").removeClass("error"),$("#submit_btn").prop("disabled",!1),$("#edit_bank_logo").val("")})}),$("#bank_logo").change(handleFileSelect),$("#edit_bank_logo").change(handleFileSelectEdit),$(document).on("click",".edit-setting",function(e){e.preventDefault();var a=$(this).data("id"),t=$("#currency_id").val(),n=$("#paymentMethod").val();a&&t&&getCpmId(a,t,n)}),$(".preview_edit_bank_logo").on("click",".remove_edit_bank_logo_preview",function(){var e=$(".thumb-bank-logo").attr("data-file-id");e?$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:ADMIN_URL+"/settings/payment-methods/delete-bank-logo",data:{file_id:e},dataType:"json",success:function(e){1==e.success?(swal(deleteTitle,e.message,"success"),$(".preview_edit_bank_logo").html(""),$(".preview_edit_bank_logo").html(`<img class="thumb-bank-logo" src="${SITE_URL}/public/uploads/userPic/default-image.png" width="120" height="80"/>`)):swal(errorTitle,e.message)}}):($(".preview_edit_bank_logo").empty(),$("#edit_bank_logo").val(""))}),$(document).on("click",".delete",function(){var e=$(this).data("id");swal({title:deleteAlert,text:alertText.replace("&#039;","'"),type:"warning",showCancelButton:!0,confirmButtonText:confirmBtnText,cancelButtonText:cancelBtnText,closeOnConfirm:!1,showLoaderOnConfirm:!0,closeOnCancel:!0},function(a){a&&(a?$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},method:"POST",url:ADMIN_URL+"/settings/payment-methods/delete-bank",dataType:"json",cache:!1,data:{bank_id:e}}).done(function(e){!0==e.status?swal({title:deleteTitle,text:e.message,type:e.type},function(){window.location.reload()}):swal(errorTitle,e.message,e.type)}).fail(function(){swal(errorTitle,errorText,"error")}):swal(cancelTitle,cancelAlert,"error"))})}),$(window).on("load",function(){var e;document.referrer==ADMIN_URL+"/settings/currency"?(localStorage.removeItem("currencyId"),localStorage.removeItem("currencyName")):localStorage.getItem("currencyName")&&localStorage.getItem("currencyId")?($(".currencyName").text(localStorage.getItem("currencyName")),$("#currency_id").val(localStorage.getItem("currencyId")),getPaymentMethodsDetails()):getPaymentMethodsSpecificCurrencyDetails()}),$(".listItem").on("click",function(){var e=$(this).attr("data-rel"),a=$(this).text();localStorage.setItem("currencyId",e),localStorage.setItem("currencyName",a),$(".currencyName").text(a),$("#currency_id").val(e),getPaymentMethodsDetails()}),$(document).on("click","#coinpayments_copy_button",function(e){e.preventDefault(),$(".coinpayments_ipn_url").select(),document.execCommand("copy"),swal({title:copyTitle,text:copyText,type:"success",icon:"success",closeOnClickOutside:!1,closeOnEsc:!1})});